<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioth√®que | Gentle Leak</title>
    <link rel="shortcut icon" href="/assets/images/Logo-Head.webp">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/others/Style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        
        body {
            background: #000;
            color: #fff;
            min-height: 100vh;
            font-family: 'Roboto', sans-serif;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }
        
        .page-header {
            max-width: 100%;
            margin: 2rem auto 1.5rem;
            padding: 0 1rem;
            text-align: center;
            width: 100%;
        }
        
        .page-header h1 {
            font-size: 36px;
            font-weight: 700;
            color: #fff;
            margin-bottom: .5rem;
        }
        
        .page-header h1 span { color: #ff9000; }
        
        .page-header p {
            color: #999;
            font-size: 15px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        #searchBar {
            max-width: 100%;
            margin: 0 auto 2rem;
            padding: 0 1rem;
            width: 100%;
        }
        
        #searchBar input {
            width: 100%;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            color: #fff;
            padding: 14px 20px;
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.2s;
        }
        
        #searchBar input:focus {
            outline: none;
            border-color: #ff9000;
            box-shadow: 0 0 0 3px rgba(255, 144, 0, 0.1);
        }
        
        #searchBar input::placeholder { color: #666; }
        
        #creatorsGrid {
            max-width: 100%;
            margin: 0 auto 4rem;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            width: 100%;
        }
        
        .creator-card {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            position: relative;
            max-width: 100%;
        }
        
        .creator-card:hover {
            border-color: #ff9000;
            transform: translateY(-6px);
            box-shadow: 0 12px 32px rgba(255, 144, 0, 0.25);
        }
        
        .creator-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #ff9000;
            transform: scaleX(0);
            transition: transform 0.3s;
        }
        
        .creator-card:hover::before { transform: scaleX(1); }
        
        .creator-img {
            width: 100%;
            aspect-ratio: 3/4;
            object-fit: cover;
            display: block;
        }
        
        .creator-info {
            padding: 20px;
        }
        
        .creator-name {
            font-size: 20px;
            font-weight: 700;
            color: #fff;
            margin: 0 0 8px;
        }
        
        .creator-stats {
            font-size: 13px;
            color: #999;
            margin: 0;
        }
        
        .creator-stats strong {
            color: #ff9000;
            font-weight: 600;
        }
        
        .creator-date {
            color: #666;
            font-size: 11px;
            margin-top: 4px;
            display: block;
        }
        
        .no-results {
            text-align: center;
            color: #666;
            padding: 3rem 1rem;
            font-size: 16px;
        }
        
        /* Mobile - 1024px and below */
        @media (max-width: 1024px) {
            .page-header h1 { font-size: 32px; }
            .page-header p { font-size: 14px; }
            #creatorsGrid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; padding: 0 0.75rem; max-width: 100% !important; }
            #searchBar { padding: 0 0.75rem; }
            .creator-name { font-size: 18px; }
            .creator-info { padding: 16px; }
        }
        
        /* Mobile - 768px and below */
        @media (max-width: 768px) {
            body { overflow-x: hidden !important; }
            .page-header { margin: 1.5rem auto 1rem; padding: 0 0.75rem !important; max-width: 100% !important; }
            .page-header h1 { font-size: 28px; margin-bottom: 0.3rem; }
            .page-header p { font-size: 13px; }
            #searchBar { margin: 0 auto 1.5rem; padding: 0 0.75rem !important; max-width: 100% !important; }
            #searchBar input { padding: 11px 16px; font-size: 14px; border-radius: 5px; }
            #creatorsGrid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 14px; padding: 0 0.5rem !important; margin-bottom: 2rem; max-width: 100% !important; }
            .creator-img { aspect-ratio: 3/4; }
            .creator-info { padding: 12px; }
            .creator-name { font-size: 14px; margin-bottom: 6px; }
            .creator-stats { font-size: 12px; }
            .creator-date { font-size: 10px; }
            .no-results { padding: 2rem 1rem; font-size: 14px; }
        }
        
        /* Mobile - 600px and below */
        @media (max-width: 600px) {
            body { overflow-x: hidden !important; }
            .page-header { margin: 1rem auto 0.75rem; padding: 0 0.5rem !important; max-width: 100% !important; }
            .page-header h1 { font-size: 22px; margin-bottom: 0.2rem; }
            .page-header p { font-size: 12px; line-height: 1.4; }
            #searchBar { margin: 0 auto 1rem; padding: 0 0.5rem !important; max-width: 100% !important; }
            #searchBar input { padding: 9px 12px; font-size: 13px; border-radius: 4px; }
            #creatorsGrid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; padding: 0 0.25rem !important; margin-bottom: 1.5rem; max-width: 100% !important; }
            .creator-img { aspect-ratio: 3/4; }
            .creator-info { padding: 10px; }
            .creator-name { font-size: 12px; margin-bottom: 4px; line-height: 1.2; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; }
            .creator-stats { font-size: 10px; }
            .creator-date { font-size: 9px; margin-top: 2px; }
            .no-results { padding: 1.5rem 0.75rem; font-size: 12px; }
        }
        
        /* Mobile - 480px and below */
        @media (max-width: 480px) {
            html { font-size: 14px !important; }
            body { overflow-x: hidden !important; }
            .page-header { margin: 0.75rem auto 0.5rem; padding: 0 0.25rem !important; max-width: 100% !important; }
            .page-header h1 { font-size: 18px; margin-bottom: 0.1rem; }
            .page-header p { font-size: 11px; line-height: 1.3; }
            #searchBar { margin: 0 auto 0.75rem; padding: 0 0.25rem !important; max-width: 100% !important; }
            #searchBar input { padding: 8px 10px; font-size: 12px; border-radius: 3px; }
            #creatorsGrid { grid-template-columns: repeat(auto-fill, minmax(95px, 1fr)); gap: 8px; padding: 0 !important; margin-bottom: 1rem; max-width: 100% !important; }
            .creator-card { border-radius: 4px; border: none; }
            .creator-img { aspect-ratio: 1/1; }
            .creator-info { padding: 8px; }
            .creator-name { font-size: 10px; margin-bottom: 2px; -webkit-line-clamp: 1; }
            .creator-stats { font-size: 9px; }
            .creator-date { font-size: 8px; margin-top: 1px; }
            .no-results { padding: 1rem 0.5rem; font-size: 11px; }
        }
    </style>
</head>
<body style="width: 100%; max-width: 100%; margin: 0; padding: 0; overflow-x: hidden;">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark" style="width: 100%; max-width: 100%;">
        <a class="navbar-brand">Gentle <span style="color:#ff9000">Leak</span></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="/index.html">Accueil</a></li>
                <li class="nav-item"><a class="nav-link active" href="/pages/biblioth√®que.html">Biblioth√®que</a></li>
            </ul>
        </div>
    </nav>

    <div class="page-header">
        <h1>Biblioth√®que <span>Cr√©ateurs</span></h1>
        <p>Liste des cr√©ateurs avec vid√©os disponibles.</p>
    </div>

    <div id="searchBar">
        <input type="text" id="searchInput" placeholder="üîç Rechercher un cr√©ateur..." />
    </div>

    <div id="creatorsGrid"></div>
    <div id="noResults" class="no-results d-none">Aucun cr√©ateur trouv√©</div>

    <script>
    (function() {
        const grid = document.getElementById('creatorsGrid');
        const searchInput = document.getElementById('searchInput');
        const noResults = document.getElementById('noResults');
        let allCreators = [];
        let creatorsMap = {};

        function escapeHtml(str) {
            const map = {'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'};
            return (str || '').replace(/[&<>"']/g, s => map[s]);
        }

        function normalize(str) {
            return (str || '').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        }

        function getCreatorImage(slug) {
            return creatorsMap[slug] || '/assets/images/placeholder.svg';
        }

        // Fetch both creators.json and videos.json
        Promise.all([
            fetch('/assets/data/creators.json').then(r => r.json()),
            fetch('/assets/data/videos.json').then(r => r.json())
        ])
        .then(([creators, videos]) => {
            creatorsMap = creators;
            
            const artistMap = {};
            
            // First pass: collect all artists with their video counts
            videos.forEach(v => {
                const slug = v.artist_slug;
                if (!artistMap[slug]) {
                    artistMap[slug] = {
                        name: v.artist,
                        slug: slug,
                        count: 0,
                        latestDate: v.date || '',
                        children: []
                    };
                }
                artistMap[slug].count++;
                if (v.date && (!artistMap[slug].latestDate || v.date > artistMap[slug].latestDate)) {
                    artistMap[slug].latestDate = v.date;
                }
            });
            
            const parentNames = {'mofos': 'MOFOS'};
            const allSlugs = Object.keys(artistMap);
            const childrenSlugs = new Set();
            const parentsByPrefix = {};
            
            // Find potential parents by looking for common prefixes
            // For each multi-part slug, check if a simpler prefix exists OR should be created
            allSlugs.forEach(slug => {
                const parts = slug.split('-');
                // Try progressively simpler parents
                for (let i = parts.length - 1; i > 0; i--) {
                    const potentialParent = parts.slice(0, i).join('-');
                    // Check if parent exists OR is "mofos" (special case: create virtual parent)
                    if (artistMap[potentialParent] || potentialParent === 'mofos') {
                        if (!parentsByPrefix[potentialParent]) {
                            parentsByPrefix[potentialParent] = [];
                        }
                        parentsByPrefix[potentialParent].push(slug);
                        childrenSlugs.add(slug);
                        console.log(`Found parent-child: ${potentialParent} <- ${slug}`);
                        break;
                    }
                }
            });
            
            // Create virtual parent entries if they don't exist (only for found parents)
            Object.keys(parentsByPrefix).forEach(prefix => {
                if (!artistMap[prefix]) {
                    artistMap[prefix] = {
                        name: parentNames[prefix] || prefix.toUpperCase(),
                        slug: prefix,
                        count: 0,
                        latestDate: '',
                        children: []
                    };
                }
            });
            
            // Link children to parents and calculate parent stats
            Object.keys(parentsByPrefix).forEach(prefix => {
                const parent = artistMap[prefix];
                console.log(`Linking ${parentsByPrefix[prefix].length} children to parent "${prefix}"`);
                parentsByPrefix[prefix].forEach(childSlug => {
                    const child = artistMap[childSlug];
                    if (child) {
                        parent.children.push(child);
                        parent.count += child.count;
                        if (child.latestDate > parent.latestDate) {
                            parent.latestDate = child.latestDate;
                        }
                    }
                });
                console.log(`Parent "${prefix}" now has ${parent.children.length} children and ${parent.count} videos`);
            });
            
            // Build final list: only include parents (not children)
            allCreators = Object.values(artistMap)
                .filter(a => !childrenSlugs.has(a.slug))
                .sort((a, b) => a.name.localeCompare(b.name));
            
            console.log('Final creators:', allCreators.map(c => ({name: c.name, children: c.children.length, count: c.count})));
            console.log('MOFOS details:', allCreators.find(c => c.slug === 'mofos'));
            render(allCreators);

            searchInput.addEventListener('input', () => {
                const q = normalize(searchInput.value.trim());
                if (!q) {
                    render(allCreators);
                    return;
                }
                const filtered = allCreators.filter(c =>
                    normalize(c.name).includes(q) || normalize(c.slug).includes(q) ||
                    c.children.some(ch => normalize(ch.name).includes(q) || normalize(ch.slug).includes(q))
                );
                render(filtered);
            });
        })
        .catch(e => {
            grid.innerHTML = '<div class="no-results">Erreur de chargement des donn√©es</div>';
            console.error('Erreur:', e);
        });

        function render(creators) {
            if (!creators.length) {
                grid.classList.add('d-none');
                noResults.classList.remove('d-none');
                return;
            }
            grid.classList.remove('d-none');
            noResults.classList.add('d-none');
            
            // Render only parent cards in the library grid
            grid.innerHTML = '';
            creators.forEach(c => {
                const imgSrc = getCreatorImage(c.slug);
                const dateText = c.latestDate ? `<span class="creator-date">Derni√®re: ${escapeHtml(c.latestDate)}</span>` : '';
                const a = document.createElement('a');
                a.href = `/artist.html?artist=${encodeURIComponent(c.slug)}`;
                a.className = 'creator-card';
                a.innerHTML = `
                    <img src="${imgSrc}"
                         onerror="this.onerror=null; this.src='/assets/images/placeholder.svg';"
                         alt="${escapeHtml(c.name)}"
                         class="creator-img"
                         loading="lazy">
                    <div class="creator-info">
                        <h3 class="creator-name">${escapeHtml(c.name)}</h3>
                        <p class="creator-stats">
                            <strong>${c.count}</strong> vid√©o${c.count > 1 ? 's' : ''}
                            ${dateText}
                        </p>
                    </div>
                `;
                grid.appendChild(a);
            });
        }
    })();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
</body>
</html>